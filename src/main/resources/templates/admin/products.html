<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>商品一覧</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/products.css">
</head>
<body>

<div class="top-bar">
    <h1><a class="ttl" th:href="@{/admin/products}">商品一覧</a> <span class="sub-title">商品管理</span></h1>
    <a class="new-button" th:href="@{/admin/products/new}">新規登録</a>
</div>

<div class="search-container">
    <form th:action="@{/admin/products/search}" method="get">
		<div class="search-box">
	        <label for="keyword">商品名</label>
	        <input type="text" class="keyword" name="keyword" th:value="${keyword}">
	        <button class="search-button">検索</button>
		</div>
		<!-- エラーメッセージ表示 -->
		<div th:if="${errorMessage}" class="error-message" th:text="${errorMessage}"></div>
    </form>
</div>

<!-- 検索結果0件時のメッセージ表示 -->
<div th:if="${message}" class="no-result-message" th:text="${message}"></div>

<!-- 「商品一覧に戻る」ボタン表示 -->
<div th:if="${showBackButton}" class="list-button-wrapper">
    <a th:href="@{/admin/products}" class="list-button">商品一覧に戻る</a>
</div>

<!-- 商品リストに商品がある場合のみ表示（検索結果0件の場合は表示なし） -->
<div th:if="${#lists.size(products) > 0}">
	<div class="search-select">
		<!-- カテゴリ絞り込みセレクトボックス -->
		<form method="get" th:action="@{/admin/products/category/{categoryId}}">
			<select class="dropdown" onchange="location.href=this.value">
				<option disabled selected>カテゴリを選択</option>
				<option th:value="@{/admin/products}"
				        th:selected="${selectedCategoryId == null}">
						すべてのカテゴリ
				</option>
				<option th:each="category : ${categories}" 
				        th:value="@{/admin/products/category/{id}(id=${category.id})}" 
				        th:text="${category.name}" 
				        th:selected="${category.id == selectedCategoryId}">
				</option>
			</select>
		</form>

		<select class="dropdown">
			<option>並び替え</option>
		</select>
	</div>
	
	<table>
	    <thead>
	        <tr>
	            <th>ID</th>
	            <th class="img">画像</th>
	            <th>商品名</th>
	            <th>カテゴリ</th>
	            <th>価格</th>
	            <th>在庫数</th>
	            <th>登録日</th>
	            <th>更新日</th>
				<th class="delete">削除</th>
	        </tr>
	    </thead>
	    <tbody>
	        <tr th:each="product : ${products}">
	            <td class="id" th:text="${product.id}">20</td>
	            <td class="img"><img class="product-img" th:src="@{${product.imagePath}}" 
				     th:attr="data-img=${product.imagePath}" 
				     alt="${product.name}" />
				</td>
	            <td class="name">
	                <a th:href="@{/admin/products/edit/{id}(id=${product.id})}" th:text="${product.name}" class="product-name">テスト</a>
	            </td>
	            <td class="category" th:text="${product.category.name}">その他</td>
	            <td class="price" th:text="${@priceFormatter.format(product.price)}">¥2,000</td>
	            <td class="stock" th:text="${product.stock}">100</td>
	            <td class="create" th:text="${#temporals.format(product.createdAt, 'yyyy/MM/dd')}">2025/04/22</td>
	            <td class="update" th:text="${#temporals.format(product.updatedAt, 'yyyy/MM/dd')}">2025/04/01</td>
				<form th:action="@{/admin/products/delete/{id}(id=${product.id})}" 
				      class="delete-form" 
					  method="post" 
					  th:attr="data-name=${product.name}">
					<input type="hidden" name="_method" value="delete">
					<td class="delete"><button type="submit" class="delete-button"><img class="delete-icon" th:src="@{/img/icon/gomibako.png}" /></button></td>
				</form>
	        </tr>
	    </tbody>
	</table>
	
</div>
	<!-- 検索が実行され、かつ結果が1件以上ある場合のみ表示 -->
	<div th:if="${keyword} and ${#lists.size(products) > 0}" class="list-button-wrapper">
	    <a th:href="@{/admin/products}" class="list-button">検索条件をクリア</a>
	</div>

<script src="/js/utils.js"></script>
</body>
</html>